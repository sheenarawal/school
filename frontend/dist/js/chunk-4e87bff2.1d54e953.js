(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e87bff2"],{"1aaf":function(e,t,a){"use strict";var n=a("f63e"),s=a.n(n);s.a},"8c47":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ValidationObserver",{scopedSlots:e._u([{key:"default",fn:function(t){var n=t.handleSubmit;return[a("div",{staticClass:"create-lesson u-container u-mr-auto u-ml-auto u-mt-17"},[a("div",{staticClass:"u-row"},[a("div",{staticClass:"u-col-12"},[a("div",{staticClass:"u-text-h2 u-mb-6 add-title"},[e._v("Edit lesson")])]),a("div",{staticClass:"u-col-6 input-block-create"},[a("ValidationProvider",{attrs:{rules:"required",name:"Name"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.errors;return[a("UTextField",{staticClass:"u-mb-12",attrs:{label:"Name",placeholder:"Name",error:n[0]},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})]}}],null,!0)}),a("ValidationProvider",{attrs:{rules:"required",name:"Description"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.errors;return[a("UTextField",{staticClass:"u-mb-12",attrs:{label:"Description",placeholder:"Description",error:n[0]},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})]}}],null,!0)}),a("CsvUpload",{staticClass:"u-mb-7",attrs:{accept:".csv"},model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1),a("div",{staticClass:"u-col-12"},[a("ImportLessonTable",{attrs:{tableRows:e.tableRows,editLesson:!0},on:{updateImages:e.updateImages,deleteRow:e.deleteRow,addNewRow:e.addNewRow,updateRows:e.updateRows}})],1),e.tableRows.length>0?a("div",{staticClass:"u-col-12 u-flex is-justify-center"},[a("UBtn",{attrs:{size:"x-large",color:"primary",id:"lesson_create_submit",loading:e.loading,width:"300"},on:{click:function(t){return n(e.updateLesson)}}},[e._v("\n          Save\n        ")])],1):e._e()])])]}}])})},s=[],i=a("a34a"),r=a.n(i),o=a("2f62"),l=a("bc3a"),u=a.n(l),c=(a("66cd"),a("cb3d")),d=a("8933"),f=a("c0c1"),p=a("6546");function h(e){return w(e)||v(e)||m(e)||b()}function b(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){if(e){if("string"===typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?g(e,t):void 0}}function v(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function w(e){if(Array.isArray(e))return g(e)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function y(e,t,a,n,s,i,r){try{var o=e[i](r),l=o.value}catch(u){return void a(u)}o.done?t(l):Promise.resolve(l).then(n,s)}function R(e){return function(){var t=this,a=arguments;return new Promise((function(n,s){var i=e.apply(t,a);function r(e){y(i,n,s,r,o,"next",e)}function o(e){y(i,n,s,r,o,"throw",e)}r(void 0)}))}}function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(Object(a),!0).forEach((function(t){S(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var E={data:function(){return{name:"",description:"",teachers:[],file:null,parsedCsv:null,tableRows:[],validateTable:!1,isTableValid:!1}},components:{CsvUpload:c["a"],TeacherList:d["a"],UTextField:f["a"],ImportLessonTable:p["a"]},computed:O(O({},Object(o["c"])("Lessons",["lesson","loading","editLesson"])),Object(o["c"])("Auth",["userRole"])),watch:{file:function(e){this.readFile()},tableRows:{handler:function(){this.validateTable&&this.validateTableRows()},deep:!0}},mounted:function(){var e=this;this.fetchLesson({id:this.$route.params.id}).then((function(t){e.name=t.data.title,e.description=t.data.description,e.teachers=t.data.teachers,e.setTableRowsFromApi(t.data.words)})),this.SET_EDIT_LESSON()},beforeDestroy:function(){this.RESET_LESSON(),this.RESET_EDIT_LESSON()},methods:O(O({},Object(o["d"])("Lessons",["RESET_LESSON","SET_EDIT_LESSON","RESET_EDIT_LESSON"])),{},{fetchLesson:function(e){return R(r.a.mark((function t(){var a;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.id,t.next=3,u.a.get("/admin/lessons/".concat(a));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},sendLesson:function(e,t){return R(r.a.mark((function a(){var n;return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.id,a.next=3,u.a.put("/admin/lessons/".concat(n),t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),a)})))()},readFile:function(){var e=this;return R(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$papa.parse(e.file,{header:!0,skipEmptyLines:!0,complete:function(t){return e.stageUploadedCsv(t)}});case 2:case"end":return t.stop()}}),t)})))()},stageUploadedCsv:function(e){this.parsedCsv=e.data,this.addTableRows()},setTableRowsFromApi:function(e){this.tableRows=e.map((function(e){return{id:e.id,delete:!1,order:e.serial,word:{isValid:!0,value:e.word},translations:{isValid:!0,values:e.all_translations.map((function(e){return{id:e.id,eng:e.eng,default:e["default"],delete:!1}}))},quote:{isValid:!0,value:e.quote},images:{isValid:!0,values:e.all_images.map((function(e){return{id:e.id,image:e.image,default:e["default"],delete:!1}}))}}}))},addTableRows:function(){var e,t=this.tableRows.length,a=t>0?this.tableRows[t-1].order+1:1,n=this.parsedCsv.map((function(e,t){return{id:"",delete:!1,order:t+a,word:{isValid:!0,value:e["Hebrew Word"]},translations:{isValid:!0,values:[{id:"",eng:e["Translation"],default:!0,delete:!1}]},quote:{isValid:!0,value:e["Quote"]},images:{isValid:!0,values:[]}}}));(e=this.tableRows).push.apply(e,h(n)),console.log(this.tableRows)},updateRows:function(e){this.tableRows=e},updateImages:function(e,t){var a=this,n=this.tableRows.findIndex((function(t){return t.order===e}));t.forEach((function(e){a.tableRows[n].images.values.push({id:"",delete:!1,image:e,default:!1})}))},deleteRow:function(e){var t=this.tableRows.findIndex((function(t){return t.order===e}));this.tableRows[t]["delete"]=!0},addNewRow:function(e){this.tableRows.push(e)},validateTableRows:function(){this.tableRows.forEach((function(e){e.word.isValid=!0,e.translations.isValid=!0,e.quote.isValid=!0,e.images.isValid=!0})),this.isTableValid=this.tableRows.every((function(e){return!!(e.word.isValid&&e.translations.isValid&&e.quote.isValid&&e.images.isValid)}))},collectPostData:function(){var e=this.tableRows.map((function(e,t){return{id:e.id,index:t+1,delete:e["delete"],word:e.word.value,translations:e.translations.values,quote:e.quote.value,images:e.images.values}})),t={title:this.name,description:this.description,teachers:this.teachers.map((function(e){return e.id})),words:e};return t},updateLesson:function(){var e=this;if(this.validateTable=!0,this.validateTableRows(),this.isTableValid){console.log(this.collectPostData()),this.$notify({title:"Please wait",text:"Lesson is uploading. This might take several minutes.",type:"warn"});var t=this.collectPostData();this.sendLesson({role:this.userRole,id:this.$route.params.id},t).then((function(){e.fetchLesson({id:e.$route.params.id}).then((function(t){e.name=t.data.title,e.description=t.data.description,e.teachers=t.data.teachers,e.setTableRowsFromApi(t.data.words)})),e.SET_EDIT_LESSON(),e.$notify({title:"Lesson successfully updatetd!",type:"success"})}))["catch"]((function(t){var a=t.message;e.$notify({title:"Lesson updating error",text:a,type:"error"})}))}}})},L=E,_=(a("1aaf"),a("2877")),x=Object(_["a"])(L,n,s,!1,null,null,null);t["default"]=x.exports},f63e:function(e,t,a){}}]);
//# sourceMappingURL=chunk-4e87bff2.1d54e953.js.map